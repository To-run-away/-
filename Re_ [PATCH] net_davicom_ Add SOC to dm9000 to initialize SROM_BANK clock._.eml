Received: from metis.ext.pengutronix.de (unknown [2001:67c:670:201:290:27ff:fe1d:cc33])
	by newmx39.qq.com (NewMx) with SMTP id 
	for <zhoubo.mr@foxmail.com>; Mon, 11 May 2020 14:25:52 +0800
X-QQ-FEAT: pSCLnAxdiZaZwW6Gm41/V916dx4Xpezr8trH9jamy+G0TDWddM4Q0vNGXFG83
	LPHRUuX4aJN1j4oWWgS7UKiRlqS+EH5DjDvMdAy43k+3gmfxYPP1XOaeY+4xxjwt4REBgO/
	J4y0mcBFKQyXjZ6fpTUcSl//XB3PbRadyiXK1g74mxc/394vXKGfNk3FZaGU6J8b3S4Optc
	iFU/wbTDajvVqqkLyEa0yiIkH/jKc1bK/i8IaM/sR/GYFqcpPWALkUY004laUmZeIZ0LBtK
	jttO2DHTxb4t2czdUmRFmP+NR4hYU7j0b1w8bOe/+Gl5ZwQ8iIWXO8cZs=
X-QQ-MAILINFO: NbUxUzKtP+7YGF5XeIH/fYUROu2cCwNGcM03bjV+LbJC1w08ovV2/rFjy
	1lDx1RxlXx1lIa464VTQF2LToVzNDC6AH+nlxT+cwyOsr0k/C9lSJ7meD6e8aQrSB2BKsg+
	drRUIUqClRZE5GNcDB5oTwNUmZMi+YhfKvqoCWgo1mnl
X-QQ-mid: mxsza19t1589178349tz3k7eq7h
X-QQ-CSender: sha@pengutronix.de
X-QQ-ORGSender: sha@pengutronix.de
X-QQ-XMAILINFO: NyHiuKvIAR7EQnzNlfYs38YIRblNcRAP4kYrkU3ZH6673Q0dMCXdz2vVzOZSVa
	 QOt3QqdRDN/pW/7784m4WH9ApxbLhv9q6pRSM7GFS1dMwWAZZln9Q5iaElldUtIgkfkKYdxRgDrT
	 WOHw6gTmefi4Q4IZwk+25zXILCkuD3Y8vbL8cJJ99NdxEZwnBCtTBKFoQ496RMQXSYORyEYm3RHw
	 rX61MC356/M+s/FNCb9TUtqbP/neRSTn5dFCgicSy3bITUB+SzJVenhMUqtc3crZDXI+L7q7QkD8
	 S1FyvcvwdJr7HEJSRjFa9rmlEeCtb5FNWTM4s8HYuPYNAlvBEabIwTfpHdO+F4yHZtQcMyOhYUuc
	 BoAefZ1qY1W/FJZauo9P7WkkKcGqriiidSguiw7SYt+eGza0YcfR5bKU0xcmdvYRUaUR6+TKPzKH
	 PBbVw/tpKQKyNGDC1OKIPHB6OTjdchQWoACj6N4cItlv5VDAUb3WPgJJ3MEKhcUxEOCKobg2Ly30
	 97v2TH1Q1pEmSYFcihulFC/ZjRPHvrnX5+VT58my4Bf8I6hNsOCdflLXkMD9BkeMGX43w5ouhBMX
	 MPlz2ixjwdlLsdRegm/bErnEAW7R1SkozDvLlNAIbff2+di4ZDOD7l+sqtX2rWRM5i6UTXB/LuQ5
	 LVwNnEbIrmgnJ/VFSNvTL2YFCMvcy9YmIWiVGt2pxppYIpGqzw3GkNG2Yh+yjucWdCILGvLNlA0D
	 AGXuTPKwNYKzQKkEGZQ6UKiRS3kKAGN1Bi6UfCZalbjZpgur6SaDD/k6rZTA+CN/jULcHyE7Vu61
	 s=
Received: from ptx.hi.pengutronix.de ([2001:67c:670:100:1d::c0])
	by metis.ext.pengutronix.de with esmtps (TLS1.3:ECDHE_RSA_AES_256_GCM_SHA384:256)
	(Exim 4.92)
	(envelope-from <sha@pengutronix.de>)
	id 1jY1sq-0002h4-Ij; Mon, 11 May 2020 08:25:48 +0200
Received: from sha by ptx.hi.pengutronix.de with local (Exim 4.92)
	(envelope-from <sha@pengutronix.de>)
	id 1jY1sk-0003yO-BB; Mon, 11 May 2020 08:25:42 +0200
Date: Mon, 11 May 2020 08:25:42 +0200
From: Sascha Hauer <s.hauer@pengutronix.de>
To: zhoubo.mr@foxmail.com
Cc: davem@davemloft.net, netdev@vger.kernel.org,
	linux-kernel@vger.kernel.org
Subject: Re: [PATCH] net/davicom: Add SOC to dm9000 to initialize SROM_BANK
 clock.
Message-ID: <20200511062542.GO5877@pengutronix.de>
References: <20200510110213.2432-1-zhoubo.mr@foxmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20200510110213.2432-1-zhoubo.mr@foxmail.com>
X-Sent-From: Pengutronix Hildesheim
X-URL: http://www.pengutronix.de/
X-IRC: #ptxdist @freenode
X-Accept-Language: de,en
X-Accept-Content-Type: text/plain
X-Uptime: 08:04:25 up 81 days, 13:34, 93 users,  load average: 0.14, 0.30,
 0.19
User-Agent: Mutt/1.10.1 (2018-07-13)
X-SA-Exim-Connect-IP: 2001:67c:670:100:1d::c0
X-SA-Exim-Mail-From: sha@pengutronix.de
X-SA-Exim-Scanned: No (on metis.ext.pengutronix.de); SAEximRunCond expanded to false
X-PTX-Original-Recipient: zhoubo.mr@foxmail.com

On Sun, May 10, 2020 at 07:02:13PM +0800, zhoubo.mr@foxmail.com wrote:
> From: To-run-away <zhoubo.mr@foxmail.com>
> 
> Increase the use of dm9000 to initialize the SROM_BANK clock in the SOC,
> otherwise the chip will not work.

The dm9000 doesn't have anything called SROM in it. You have to
describe the clock input pin of the dm9000 here, not the pin of
your SoC where the clock is coming out.

> The device tree file can be increased like this:
> ethernet@88000000 {
>     compatible = "davicom,dm9000";
>     ....
>     clocks = <&clocks CLK_SROMC>;
>     clock-names = "sromc";

This must be documented in
Documentation/devicetree/bindings/net/davicom-dm9000.txt.

> +	/* Enable clock if specified */
> +	if (!of_property_read_string(dev->of_node, "clock-names", &clk_name)) {
> +		struct clk *clk = devm_clk_get(dev, clk_name);
> +		if (IS_ERR(clk)) {
> +			dev_err(dev, "cannot get clock of %s\n", clk_name);
> +			ret = PTR_ERR(clk);
> +			goto out;
> +		}
> +		clk_prepare_enable(clk);
> +		dev_info(dev, "enable clock '%s'\n", clk_name);
> +	}

There's devm_clk_get_optional() which you should use here.

the "name" passed to devm_clk_get_optional() should match the name of
the clock, you must specify it according to the dm9000 datasheet. It
makes no sense to read the name from the device tree, instead pick a
name which you expect to be there.

Sascha

-- 
Pengutronix e.K.                           |                             |
Steuerwalder Str. 21                       | http://www.pengutronix.de/  |
31137 Hildesheim, Germany                  | Phone: +49-5121-206917-0    |
Amtsgericht Hildesheim, HRA 2686           | Fax:   +49-5121-206917-5555 |

